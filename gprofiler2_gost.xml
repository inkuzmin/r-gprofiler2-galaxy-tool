<?xml version="1.0"?>
<tool id="gprofiler2_gost" name="g:Profiler / g:GOSt" version="@VERSION@">
    <description>performs functional enrichment analysis of gene lists</description>
    <macros>
        <import>macros.xml</import>
    </macros>
    <expand macro="requirements"></expand>
    <expand macro="stdio" />
    <command detect_errors="exit_code"><![CDATA[
        Rscript '$__tool_directory__/gprofiler2_gost.R'
            --input "$input"
            --organism "$organism"
            $ordered_query

            $advanced_options.significant
            $advanced_options.measure_underrepresentation
            $advanced_options.evcodes

            $data_sources.exclude_iea
            
            --user_threshold $advanced_options.user_threshold
            --correction_method "$advanced_options.correction_method"
            --domain_scope "$advanced_options.domain_scope"
            --custom_bg "$advanced_options.custom_bg"
            --numeric_ns "$advanced_options.numeric_ns"

            #if $data_sources.go_sources
                #for $source in $data_sources.go_sources
                    --sources $source
                #end for
            #end if

            #if $data_sources.bp_sources
                #for $source in $data_sources.bp_sources
                    --sources $source
                #end for
            #end if

            #if $data_sources.reg_sources
                #for $source in $data_sources.reg_sources
                    --sources $source
                #end for
            #end if

            #if $data_sources.proto_sources
                #for $source in $data_sources.proto_sources
                    --sources $source
                #end for
            #end if

            #if $data_sources.hp_sources
                --sources $data_sources.hp_sources
            #end if

            --output "$output"
            --plot "$plot"
            --base_url "$tool_settings.base_url"
    ]]></command>
    <inputs>
        <param type="data" name="input" format="txt"
            label="Input is whitespace-separated list of genes" />

        <param type="text" name="organism" label="Organism"
            help="Organism IDs are constructed by concatenating the first letter of the generic name and the specific name. Examples: human — Homo sapiens — 'hsapiens', mouse — Mus musculus — 'mmusculus', thale cress — Arabidopsis thaliana — 'athaliana'. Check the help section below for the complete list of supported organism IDs."
            value="hsapiens">
        </param>
        
        <param type="boolean" name="ordered_query" label="Ordered query"
            optional="true"
            help="When input gene lists are ranked this option may be used to get GSEA style p-values."
            truevalue="--ordered_query" falsevalue=""  />

        <section name="advanced_options" title="Advanced options" expanded="false">
            <param type="boolean" name="significant" label="Significant only"
                optional="true"
                help="Whether all or only statistically significant results should be returned."
                checked="true"
                truevalue="--significant" falsevalue="" />

            <param type="boolean" name="measure_underrepresentation"
                label="Measure underrepresentation"
                optional="true"
                truevalue="--measure_underrepresentation" falsevalue="" />

            <param type="boolean" name="evcodes" label="Evidence codes"
                optional="true"
                help="Include evidence codes to the results. Note that this can decrease performance
                and make the query slower. In addition, a column ’intersection’ is created that
                contains the gene id-s that intersect between the query and term."
                truevalue="--evcodes" falsevalue="" />

            <param type="float" name="user_threshold" label="User threshold"
                optional="true"
                help="Custom p-value threshold, results with a larger p-value are excluded."
                value="0.05" />

            <param name="correction_method" type="select" label="Significane threshold"
                multiple="false"
                optional="true"
                help="The algorithm used for multiple testing correction">
                <option selected="true" value="gSCS">g:SCS threshold</option>
                <option value="bonferroni">Bonferroni correction</option>
                <option value="fdr">Benjamini-Hochberg FDR</option>
            </param>

            <param name="domain_scope" type="select" label="Statistical domain scope"
                multiple="false"
                optional="true"
                help="Effective genomic landscape for statistical testing.">
                <option selected="true" value="annotated">Only annotated genes</option>
                <option value="known">All known genes</option>
                <option value="custom">Custom</option>
            </param>

            <param type="data" optional="true" name="custom_bg" format="tabular"
                label="Custom background" />

            <param type="text" name="numeric_ns" label="Numeric IDs treated as"
                optional="true"
                help="The prefix for fully numeric IDs. Check the help section below for the complete list of supported namespaces."
                value="" />
        </section>

        <section name="data_sources" title="Data sources" expanded="false">
            <param name="go_sources" optional="true" type="select" label="Gene Ontology" multiple="true" display="checkboxes">
                <option selected="true" value="BP">GO biological process</option>
                <option selected="true" value="MF">GO molecular function</option>
                <option selected="true" value="CC">GO biological process</option>
            </param>

            <param type="boolean" name="exclude_iea" label="No electronic GO annotations"
                optional="true"
                help="Exclude electronic GO annotations (IEA evidence code)."
                truevalue="--exclude_iea" falsevalue=""  />

            <param name="bp_sources" optional="true" type="select"
                label="biological pathways"
                multiple="true"
                display="checkboxes">
                <option selected="true" value="KEGG">KEGG</option>
                <option selected="true" value="REAC">Reactome</option>
                <option selected="true" value="WP">WikiPathways</option>
            </param>

            <param name="reg_sources" optional="true" type="select" label="regulatory motifs in DNA" multiple="true" display="checkboxes">
                <option selected="true" value="TF">TRANSFAC</option>
                <option selected="true" value="MIRNA">miRTarBase</option>
            </param>

            <param name="proto_sources" optional="true" type="select" label="protein databases" multiple="true" display="checkboxes">
                <option selected="true" value="HPA">Human Protein Atlas</option>
                <option selected="true" value="CORUM">CORUM</option>
            </param>

            <param name="hp_sources" optional="true" type="select" label="Human phenotype ontology" multiple="true" display="checkboxes">
                <option selected="true" value="HP">HP</option>
            </param>
        </section>

        <expand macro="tool_settings">
            <param type="boolean" name="export_plot" label="Export image"
                optional="true"
                help="A publication ready image will be created alongside the tabular output. The plot is very similar to the one shown in the g:GOSt web tool."
                value="false" />
        </expand>
        </inputs>
    <outputs>
         <data label="${tool.name} on ${on_string}"
            name="output" format="tabular" />

         <data label="${tool.name} on ${on_string} (plot)"
            name="plot" format="png">
            <filter>tool_settings['export_plot']</filter>
        </data>
    </outputs>
     <tests>
        <test>
            <param name="input" value="example_query.txt" ftype="txt" />
            <param name="base_url" value="http://biit.cs.ut.ee/gprofiler_archive3/e94_eg41_p11" />
            <output name="output" file="example_gost_results.txt" ftype="tabular" />
        </test>
    </tests>

    <help>
**What it does**
  This tool wraps gprofiler2 R package which performs a request to g:Profiler g:GOSt tool through its API. g:Profiler g:GOSt performs functional enrichment analysis of gene lists. The output is a table with the results and (optionally) a publication ready plot similar to the one shown in the g:GOSt web tool.

----

@REFERENCES@

    </help>
    <expand macro="citations"></expand>
    <edam_topics>
        <edam_topic>topic_0091</edam_topic>
    </edam_topics>
    <edam_operations>
        <edam_operation>operation_2436</edam_operation>
    </edam_operations>
</tool>